<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Tade Souaiaia" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Day 2b - prsWorkshop</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Day 2b";
        var mkdocs_page_input_path = "Day4a.docx.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> prsWorkshop
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Preparation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../prep_list/">Checklist</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../prep_os/">System</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../prep_terminal/">Terminal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../prep_software/">Software</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../prep_testing/">Testing</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Program</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../Day2.docx/">Day 1a</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Day3a.docx/">Day 1b</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Day3b.docx/">Day 2a</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Day 2b</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#learning-objectives">Learning Objectives</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#introduction-to-bridgeprs">Introduction to BridgePRS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#bridgeprs-scenario-1-application-of-african-gwas-weights-to-an-african-target-group">BridgePRS Scenario 1: Application of African GWAS weights to an African target group</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#create-configuration-file-for-the-target-only-analysis">Create configuration file for the target-only analysis</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#questions">Questions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#note">Note</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#single-ancestry-bridgeprs-analysis">Single ancestry BridgePRS analysis:</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#task">Task</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#questions_1">Questions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#bridgeprs-scenario-2-prediction-into-african-target-data-using-european-and-african-summary-statistics">BridgePRS Scenario 2:  Prediction into African target data using European and African summary statistics</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#create-configuration-file-for-base-and-target-populations">Create configuration file for base and target populations</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#question">Question</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#tasks">Tasks</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#multi-ancestry-bridgeprs-analysis">Multi-ancestry BRIDGEPRS analysis:</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#tasks_1">Tasks</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#questions_2">Questions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#short-quiz">Short Quiz</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#file-types">File types</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#answer">Answer</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../misc_commands/">Bash Tutorial</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../misc_R/">R Tutorial</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../misc_python/">Python Tutorial</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../misc_plink/">Plink Tutorial</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Misc</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../misc_linux/">Installing Linux</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../misc_plink_problem/">Mac Security</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">prsWorkshop</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Program</li>
      <li class="breadcrumb-item active">Day 2b</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/tadesouaiaia/prsWorkshop-website/edit/master/docs/Day4a.docx.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="bridgeprs">BridgePRS</h2>
<h3 id="learning-objectives">Learning Objectives</h3>
<p>The goal of this practical is to implement the basic steps needed to implement multi-ancestry PRS prediction models successfully, using the BridgePRS software.</p>
<p>By the end of this session participants will understand how to:
- Set up the configuration files used as input by the software.
- Edit and interact with BridgePRS via the command line. 
- Implement the 3 PRS models integral to the functionality of the software, using the integrative "easy run" function.
- Perform a single-ancestry version of the BridgePRS method.</p>
<h3 id="introduction-to-bridgeprs">Introduction to BridgePRS</h3>
<p>BridgePRS is a Bayesian PRS method that integrates trans-ancestry GWAS summary statistics. Unlike the fine-mapping approach of PRS-CSx, BridgePRS retains all variants within loci to best tag causal variants shared across ancestries. The focus is on correctly estimating causal effect sizes, which is key when the goal is prediction, rather than on estimating their location. BridgePRS is most applicable for combining information of a well-powered GWAS performed in a (discovery) population or populations unmatched to the ancestry of the target sample, with a second GWAS of relatively limited power in a (target) population that is matched to the ancestry of the target sample.</p>
<p>BridgePRS is first applied to a large discovery population GWAS, by running Bayesian ridge regression, at putative loci. The BridgePRS algorithm is trained according to 3 PRS models:
1. PRS run using only the target (Non-European) dataset (prs-single)
2. PRS run using SNP-weights calculated from the European Model (prs-port)
3. PRS run using a prior effect-size distribution from the European Model (prs-prior)
The 3 models are subsequently combined to produce a weighted PRS solution</p>
<p>As well as applying each of the steps in sequence, models can also be run separately according to the needs of individual users. Here, we use the single-ancestry BridgePRS approach to train polygenic scores for an African target sample applying the Bayesian ridge regression approach of BridgePRS to shrink the effect size of SNPs derived from an African ancestry GWAS towards their true underlying values.
<br><br> </p>
<h3 id="bridgeprs-scenario-1-application-of-african-gwas-weights-to-an-african-target-group">BridgePRS Scenario 1: Application of African GWAS weights to an African target group</h3>
<h4 id="create-configuration-file-for-the-target-only-analysis">Create configuration file for the target-only analysis</h4>
<p>In this example we will run BridgePRS across chromosomes 1 - 22. The first required step is to generate the configuration file needed to run the desired single ancestry BridgePRS analysis. The following command should be run from the main directory:
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>bridgePRS check pop -o out_config-AFR-single --pop AFR --sumstats_prefix data/pop_europe/sumstats/eur.chr --genotype_prefix data/pop_africa/genotypes/afr_genotypes --phenotype_file data/pop_africa/phenotypes/afr_pheno.dat
</code></pre></div>
(BridgePRS produces on-screen information which tells you some of the tasks the software is doing behind the scenes).</p>
<h4 id="questions">Questions</h4>
<p>From the on-screen output:
1. Do you notice anything interesting in the way BridgePRS handled the phenotype file?
2. How many phenotypes was BridgePRS able to identify in the phenotype file? in what way do these phenotypes differ?
3. Which resulting files have been generated in ./out/save/ ?</p>
<h4 id="note">Note</h4>
<p>In the next code snippet the file path of the newly created .config (configuration) file has been incorporated into the run command. This information was provided as part of the on-screen output in the previous step. </p>
<h3 id="single-ancestry-bridgeprs-analysis">Single ancestry BridgePRS analysis:</h3>
<p>Now that we have our African configuration file prepared we are ready to perform the single-ancestry BridgePRS analysis.
In this step we opt to select the continuous version of the trait for analysis.
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>bridgePRS prs-single run -o out_config-AFR-single --pop africa --config_files out_config-AFR-single/save/primary.AFR.config --phenotype y
</code></pre></div></p>
<h4 id="task">Task</h4>
<ul>
<li>Review the contents of the output directory  out_bridge-AFR-single/prs-single_AFRICA and subfolders</li>
</ul>
<h4 id="questions_1">Questions</h4>
<ol>
<li>What evidence can you see that the analysis was successfully executed?</li>
</ol>
<p><br><br> </p>
<h3 id="bridgeprs-scenario-2-prediction-into-african-target-data-using-european-and-african-summary-statistics">BridgePRS Scenario 2:  Prediction into African target data using European and African summary statistics</h3>
<p>BridgePRS is most commonly used to combine the power of a smaller ancestry-matched GWAS with a much larger but genetically-distant GWAS population, for the purpose of maximising PRS prediction quality for under-served target populations.</p>
<h4 id="create-configuration-file-for-base-and-target-populations">Create configuration file for base and target populations</h4>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>bridgePRS check pops -o out_config-EUR-AFR-easyrun --pop AFR EUR --sumstats_prefix data/pop_africa/sumstats/afr.chr data/pop_europe/sumstats/eur.chr --sumstats_suffix .glm.linear.gz .glm.linear.gz --genotype_prefix data/pop_africa/genotypes/afr_genotypes --phenotype_file data/pop_africa/phenotypes/afr_pheno.dat
</code></pre></div>
<h4 id="question">Question</h4>
<ol>
<li>Carefully check the information given in the on-screen output: (i) How many different .config files have been produced
   and (ii) where are they located?</li>
</ol>
<h4 id="tasks">Tasks</h4>
<ul>
<li>Incorporate the config path information into the code template provided below (for both European and African .config files).</li>
<li>Based on your-recent understanding of genetic distances between continental populations, choose a sensible  <br />
  value of the --fst parameter to reflect the genetic distance between Africans and Europeans. This extra information will inform the prior   distribution from which posterior effect weights for the target population will be calculated. This needs to be done before attempting to
  run the code given below.</li>
</ul>
<h3 id="multi-ancestry-bridgeprs-analysis">Multi-ancestry BRIDGEPRS analysis:</h3>
<p>Add the missing peices of information to the code below, as you enter it into your terminal.
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>bridgePRS easyrun go -o out_easyrun-EUR-AFR --config_files target.AFR.config base.EUR.config --fst --phenotype y
</code></pre></div></p>
<h4 id="tasks_1">Tasks</h4>
<ul>
<li>After running the above code, navigate to the output directory: ./out_config-EUR-AFR-easyrun to inspect the results.</li>
<li>Open either of the 2 plots that you see in the directory.</li>
</ul>
<h4 id="questions_2">Questions</h4>
<ol>
<li>In the summary plot, which set of values expresses the correlation between the weights calculated by BridgePRS and
   the beta weights from the initial GWASs?</li>
<li>In which output directory will you find precise values of variance explained by the prs-combined-AFR model?</li>
<li>What is the variance explained by the prs-combined-AFR model?</li>
</ol>
<h3 id="short-quiz">Short Quiz</h3>
<p>I have GWAS data and genotype/phenotype data for a cohort consisting of &gt;2000 samples from a small East European population. 
The population LD structure is unique and so I would like this information to be incorporated into my PRS prediction model. I additionally have GWAS and genotype/phenotype data from the UKB biobank that I want to include. How should I formulate the relevant Config files for the BridgePRS analysis?</p>
<h4 id="file-types">File types</h4>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>ukr/sumstats/ukr.sumstats.out
ukr/genotypes/chr1.bed,bim,fam...chr22.bed,bin,fam,
ukr/phenotypes/ukr_test.dat, ukr/phenotypes/ukr_validation.dat
ukb/sumstats/ukb.sumstats.gz
ukb/genotypes/chr1.bed,bim,fam...chr22.bed,bin,fam
ukb/phenotypes/ukb_test.dat, ukb/phenotypes/ukb_validation.dat
</code></pre></div>
<h4 id="answer">Answer</h4>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Target config:
POP=
LDPOP=
SUMSTATS_PREFIX=
GENOTYPE_PREFIX=
PHENOTYPE_FILE=
VALIDATION_FILE=

Model config file:
POP=
LDPOP=
SUMSTATS_PREFIX=
GENOTYPE_PREFIX=
PHENOTYPE_FILE=
VALIDATION_FILE=
</code></pre></div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../Day3b.docx/" class="btn btn-neutral float-left" title="Day 2a"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../misc_commands/" class="btn btn-neutral float-right" title="Bash Tutorial">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/tadesouaiaia/prsWorkshop-website" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../Day3b.docx/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../misc_commands/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      <script src="../javascripts/details.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
